# Release Notes - v0.12.0 LLM Cluster Labels + Paper Recommendations + Report Export

**Release Date**: 2026-02-06
**Type**: Feature Release
**Branch**: `tto-poc`

---

## Overview

v0.12.0 adds three new features to the Gap Analysis system:

1. **LLM-Summarized Cluster Labels** — Replaces keyword-join cluster names with concise 3-5 word topic labels generated by LLM
2. **Gap-Based Paper Recommendations** — Search Semantic Scholar for papers that could bridge detected research gaps
3. **Gap Analysis Report Export** — Download the full gap analysis as a structured Markdown report

---

## New Features

### Phase 1: LLM-Summarized Cluster Labels

**Problem**: Cluster labels like "machine learning / neural networks / deep learning" are verbose and hard to scan.

**Solution**: LLM generates concise topic labels (e.g., "Deep Learning Methods") from cluster keywords.

| Aspect | Detail |
|--------|--------|
| **Endpoint** | `POST /api/graph/gaps/{project_id}/refresh` (existing, enhanced) |
| **Method** | `GapDetector.generate_cluster_labels()` |
| **Timeout** | 3s per label, 15s total budget |
| **Fallback** | Keeps original keyword-join name on LLM failure |
| **LLM Provider** | Uses configured default (Groq/Anthropic/OpenAI) |

**Files Changed**:
- `backend/graph/gap_detector.py` — New `generate_cluster_labels()` method + integration in `analyze_graph()`
- `backend/routers/graph.py` — LLM provider injection in `refresh_gap_analysis()`

### Phase 2: Gap-Based Paper Recommendations

**Problem**: Researchers identify gaps but have no automated way to find relevant papers.

**Solution**: Query Semantic Scholar using gap metadata (bridge candidates + cluster keywords).

| Aspect | Detail |
|--------|--------|
| **Endpoint** | `GET /api/graph/gaps/{project_id}/recommendations?gap_id={uuid}&limit=5` |
| **Query Strategy** | `bridge_candidates[:3] + cluster_a_names[:2] + cluster_b_names[:2]` |
| **Timeout** | 15s endpoint-level timeout |
| **Error Handling** | Returns empty papers + error message on failure |
| **Frontend Cache** | Session-level via React state (`recommendations[gapId]`) |

**Response Schema**:
```json
{
  "gap_id": "uuid",
  "query_used": "concept1 concept2 ...",
  "papers": [
    {
      "title": "Paper Title",
      "year": 2024,
      "citation_count": 42,
      "url": "https://doi.org/...",
      "abstract_snippet": "First 200 chars..."
    }
  ],
  "error": null
}
```

**Files Changed**:
- `backend/routers/graph.py` — New `get_gap_recommendations()` endpoint
- `frontend/lib/api.ts` — `getGapRecommendations()` method
- `frontend/components/graph/GapPanel.tsx` — "Find Papers" button + paper cards

### Phase 3: Gap Analysis Report Export

**Problem**: No way to save/share gap analysis results outside the application.

**Solution**: Download complete gap analysis as structured Markdown.

| Aspect | Detail |
|--------|--------|
| **Endpoint** | `GET /api/graph/gaps/{project_id}/export?format=markdown` |
| **Output** | Markdown file with clusters table + gap sections + research questions |
| **Download** | `StreamingResponse` with `Content-Disposition` header |
| **Filename** | `gap_analysis_{project_name}.md` |

**Report Structure**:
- Project metadata (name, research question, date)
- Cluster Overview table (ID, label, size, top concepts)
- Structural Gaps (sorted by strength, with bridge candidates and research questions)

**Files Changed**:
- `backend/routers/graph.py` — New `export_gap_report()` endpoint
- `frontend/lib/api.ts` — `exportGapReport()` method (blob download)
- `frontend/components/graph/GapPanel.tsx` — "Export Report" button

---

## API Reference (New Endpoints)

### GET `/api/graph/gaps/{project_id}/recommendations`

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `project_id` | UUID (path) | Yes | Project UUID |
| `gap_id` | UUID (query) | Yes | Gap UUID from analysis |
| `limit` | int (query) | No | 1-10, default 5 |

**Responses**: `200 OK`, `404 Gap not found`, `422 Validation Error`

### GET `/api/graph/gaps/{project_id}/export`

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `project_id` | UUID (path) | Yes | Project UUID |
| `format` | string (query) | No | `markdown` (default) |

**Responses**: `200 OK` (file download), `404 Project/data not found`

---

## Frontend Changes

### GapPanel.tsx
- **Find Papers** button in each expanded gap (teal accent, matches design system)
- **Paper cards** showing title (linked), year, citation count, abstract snippet
- **3 UI states**: Loading spinner, error message, empty result message
- **Export Report** button at panel bottom (visible when gaps exist)
- **Session caching**: Same gap click returns cached results without re-fetching

---

## Migration Notes

- No database migration required
- No environment variable changes required
- Existing LLM provider configuration used for cluster labels
- Semantic Scholar API requires no API key (rate limited at 100 req/5min)

---

## Testing Checklist

- [ ] Gap refresh → cluster labels are 3-5 words (not keyword lists)
- [ ] Gap refresh without LLM → fallback to keyword-join labels
- [ ] Paper recommendations → 5 papers returned with valid data
- [ ] Paper recommendations → invalid gap_id returns 422
- [ ] Paper recommendations → Semantic Scholar timeout returns error message
- [ ] Report export → valid Markdown file downloads
- [ ] Report export → filename matches project name
- [ ] Report export → empty project returns 404
- [ ] Frontend "Find Papers" → loading/success/error states work
- [ ] Frontend "Find Papers" → re-click shows cached results
- [ ] Frontend "Export Report" → .md file downloads in browser
