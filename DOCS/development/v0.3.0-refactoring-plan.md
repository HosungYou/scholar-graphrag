# ScholaRAG_Graph v0.3.0 ë¦¬íŒ©í† ë§ ê³„íš

> **ë¬¸ì„œ ë²„ì „**: 2024-01-19
> **í˜„ì¬ ë²„ì „**: v0.2.1 â†’ **ëª©í‘œ ë²„ì „**: v0.3.0
> **í•µì‹¬ ëª©í‘œ**: ì—°êµ¬ìì—ê²Œ "Wow" ëª¨ë¨¼íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ê°œì„ 

---

## ê°œìš”

### í”„ë¡œì íŠ¸ ì •ë³´
- **GitHub**: https://github.com/HosungYou/ScholaRAG_Graph
- **ë¡œì»¬ ê²½ë¡œ**: `/Volumes/External SSD/Projects/ScholaRAG_Graph_Review/`

### ìš°ì„ ìˆœìœ„ ë¶„ì„

| ìˆœìœ„ | ê°œì„  ì˜ì—­ | ì—°êµ¬ì ì„íŒ©íŠ¸ | ê¸°ìˆ  ë³µì¡ë„ | ROI |
|------|----------|--------------|------------|-----|
| **1** | Semantic Chunking | ğŸ”¥ Critical | Medium | Very High |
| **2** | Zotero Tags/Notes í™œìš© | High | Low | High |
| **3** | Section-Aware ì¶”ì¶œ | High | Medium | High |
| **4** | í•™ìˆ  ì„ë² ë”© (SPECTER2) | Medium | Low | Medium |

---

## ì•„í‚¤í…ì²˜ ì´í•´

### ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Zotero RDF Import                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Zotero RDF â”€â”€â”¬â”€â”€â–¶ Paper Metadata (title, authors, year, doi)  â”‚
â”‚               â”‚         â†“                                       â”‚
â”‚               â”‚    paper_metadata í…Œì´ë¸” (ë°°ê²½ ì»¨í…ìŠ¤íŠ¸)        â”‚
â”‚               â”‚                                                 â”‚
â”‚               â””â”€â”€â–¶ Abstract/PDF Text                            â”‚
â”‚                         â†“                                       â”‚
â”‚                    LLM Entity Extraction                        â”‚
â”‚                         â†“                                       â”‚
â”‚                    entities í…Œì´ë¸” (ê·¸ë˜í”„ ë…¸ë“œ)                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### EntityType ë¶„ë¥˜

| ì¹´í…Œê³ ë¦¬ | íƒ€ì… | ì†ŒìŠ¤ | ì‹œê°í™” |
|---------|------|------|--------|
| **ë©”íƒ€ë°ì´í„°** | PAPER, AUTHOR | Zotero RDF íŒŒì‹± | âŒ (ë°°ê²½) |
| **ì£¼ìš” ë…¸ë“œ** | CONCEPT, METHOD, FINDING | LLM ì¶”ì¶œ | âœ… |
| **í™•ì¥ ë…¸ë“œ** | PROBLEM, DATASET, METRIC, INNOVATION, LIMITATION | LLM ì¶”ì¶œ | âœ… |

> **í•µì‹¬**: Authors/PaperëŠ” Zotero RDFì—ì„œ ë©”íƒ€ë°ì´í„°ë¡œ ì´ë¯¸ íŒŒì‹±ë˜ë¯€ë¡œ LLM ì¶”ì¶œ ë¶ˆí•„ìš”

---

## êµ¬í˜„ ê³„íš

### Phase 1: Quick Wins (1-2ì¼) âœ… ì™„ë£Œ

#### 1.1 Zotero Tags â†’ Seed Concepts âœ…
**íŒŒì¼**: `backend/importers/zotero_rdf_importer.py`, `backend/graph/entity_extractor.py`

**ë³€ê²½ ë‚´ìš©**:
1. `_parse_item_element`ì— notes íŒŒì‹± ì¶”ê°€ (`bib:Memo`, `z:Note`)
2. `extract_entities`ì— `seed_concepts`, `user_notes` íŒŒë¼ë¯¸í„° ì¶”ê°€
3. `import_folder`ì—ì„œ tags/notesë¥¼ entity_extractorë¡œ ì „ë‹¬
4. User-provided tagsëŠ” high-confidence (0.95) conceptsë¡œ ì¶”ê°€

**ê¸°ëŒ€ íš¨ê³¼**: ì—°êµ¬ìì˜ ìˆ˜ë™ ë¶„ë¥˜ ì‘ì—…ì´ ì§€ì‹ ê·¸ë˜í”„ì— ì¦‰ì‹œ ë°˜ì˜

#### 1.2 Extended Entity Types í™œì„±í™” âœ…
**íŒŒì¼**: `backend/graph/entity_extractor.py`

**ë³€ê²½ ë‚´ìš©**:
1. `FAST_EXTRACTION_PROMPT` í™•ì¥ (problems, innovations, limitations, datasets)
2. `_parse_llm_response`ì— datasets íŒŒì‹± ì¶”ê°€
3. `_empty_result`ì— datasets ì¶”ê°€
4. `extract_entities`ì—ì„œ ìƒˆ íƒ€ì… ë§¤í•‘ ì¶”ê°€

**ê¸°ëŒ€ íš¨ê³¼**: ë” í’ë¶€í•œ ì§€ì‹ ê·¸ë˜í”„ (ê¸°ì¡´ 3ê°œ â†’ 7ê°œ ì—”í„°í‹° íƒ€ì…)

---

### Phase 2: Core Improvements (3-5ì¼) âœ… ì™„ë£Œ

#### 2.1 Semantic Chunking íŒŒì´í”„ë¼ì¸
**ì‹ ê·œ íŒŒì¼**: `backend/importers/semantic_chunker.py`

**ì•„í‚¤í…ì²˜**:
```
PDF â†’ PyMuPDF (ë ˆì´ì•„ì›ƒ) â†’ Section Detector â†’ Hierarchical Chunker â†’ DB
                              â”‚                      â”‚
                      [Introduction]          [Parent Chunk: ì„¹ì…˜ ì „ì²´]
                      [Methods]               [Child Chunks: ë¬¸ë‹¨ë³„ 400í† í°]
                      [Results]
                      [Discussion]
```

#### 2.2 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¶”ê°€
**ì‹ ê·œ íŒŒì¼**: `database/migrations/011_semantic_chunks.sql`

```sql
CREATE TABLE semantic_chunks (
    id UUID PRIMARY KEY,
    paper_id UUID REFERENCES paper_metadata(id),
    project_id UUID REFERENCES projects(id),
    text TEXT NOT NULL,
    summary TEXT,
    section_type VARCHAR(50),
    parent_chunk_id UUID REFERENCES semantic_chunks(id),
    chunk_level INTEGER DEFAULT 0,
    embedding_cohere vector(1536),
    token_count INTEGER,
    sequence_order INTEGER
);
```

#### 2.3 Section-Aware Entity Extraction
**íŒŒì¼**: `backend/graph/entity_extractor.py`

**ë³€ê²½ ë‚´ìš©**: ì„¹ì…˜ë³„ íŠ¹í™” í”„ë¡¬í”„íŠ¸ ì¶”ê°€
```python
SECTION_PROMPTS = {
    "methodology": "ë°©ë²•ë¡ , ë°ì´í„°ì…‹, ì¸¡ì • ì§€í‘œì— ì§‘ì¤‘...",
    "results": "ë°œê²¬ì‚¬í•­, íš¨ê³¼ í¬ê¸°, í†µê³„ì— ì§‘ì¤‘...",
    "discussion": "ì‹œì‚¬ì , í•œê³„, í–¥í›„ ì—°êµ¬ì— ì§‘ì¤‘...",
}
```

---

### Phase 3: Advanced Features (5-7ì¼) âœ… ì™„ë£Œ

#### 3.1 SPECTER2 í•™ìˆ  ì„ë² ë”© í†µí•© (ì„ íƒì )
> âš ï¸ Phase 2 ì™„ë£Œ í›„ Cohere ë‹¨ë… ì„±ëŠ¥ í‰ê°€í•˜ì—¬ ê²°ì •

#### 3.2 Hierarchical Retriever
**ì‹ ê·œ íŒŒì¼**: `backend/graph/hierarchical_retriever.py`

#### 3.3 Incremental Zotero Sync
- `zotero_item_key` ì¶”ì 
- íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ diff ì—…ë°ì´íŠ¸

---

## íŒŒì¼ ë³€ê²½ ë§¤íŠ¸ë¦­ìŠ¤

| íŒŒì¼ | Phase | ìƒíƒœ | ë³€ê²½ ë‚´ìš© |
|------|-------|------|----------|
| `importers/zotero_rdf_importer.py` | 1.1, 3.3 | âœ… | Tags/notes í†µí•©, sync_folder ì¶”ê°€ |
| `graph/entity_extractor.py` | 1.2, 2.3 | âœ… | í™•ì¥ íƒ€ì…, seed concepts, SECTION_PROMPTS |
| `importers/semantic_chunker.py` | 2.1 | âœ… | **ì‹ ê·œ** - ì„¹ì…˜ íƒì§€ + ê³„ì¸µì  ì²­í‚¹ |
| `database/migrations/011_*.sql` | 2.2 | âœ… | **ì‹ ê·œ** - semantic_chunks ìŠ¤í‚¤ë§ˆ |
| `llm/specter_embeddings.py` | 3.1 | âœ… | **ì‹ ê·œ** - SPECTER2 + DualEmbedding provider |
| `graph/hierarchical_retriever.py` | 3.2 | âœ… | **ì‹ ê·œ** - ê³„ì¸µì  ê²€ìƒ‰ + ì„¹ì…˜ ë¼ìš°íŒ… |

---

## ì§„í–‰ ìƒí™©

### Phase 1 ê²€ì¦ ê²°ê³¼ (2024-01-19) âœ…

```
âœ… EntityType.PROBLEM exists
âœ… EntityType.DATASET exists  
âœ… EntityType.METRIC exists
âœ… EntityType.INNOVATION exists
âœ… EntityType.LIMITATION exists
âœ… "problems" in FAST_EXTRACTION_PROMPT
âœ… "innovations" in FAST_EXTRACTION_PROMPT
âœ… "limitations" in FAST_EXTRACTION_PROMPT
âœ… "datasets" in FAST_EXTRACTION_PROMPT
âœ… entity_extractor.py - êµ¬ë¬¸ ì •ìƒ
âœ… zotero_rdf_importer.py - êµ¬ë¬¸ ì •ìƒ
```

### Phase 2 ê²€ì¦ ê²°ê³¼ (2024-01-19) âœ…

```
=== Semantic Chunker Tests ===
âœ… "1. Introduction" -> introduction
âœ… "2. Methods" -> methodology
âœ… "3. Results" -> results
âœ… "4. Discussion" -> discussion
âœ… "5. Conclusion" -> conclusion
âœ… "References" -> references
âœ… All expected sections detected!
âœ… semantic_chunker.py - êµ¬ë¬¸ ì •ìƒ
âœ… entity_extractor.py (SECTION_PROMPTS) - êµ¬ë¬¸ ì •ìƒ
```

**ì‹ ê·œ íŒŒì¼**:
- `backend/importers/semantic_chunker.py` (~400 lines)
- `database/migrations/011_semantic_chunks.sql` (~150 lines)

### Phase 3 ê²€ì¦ ê²°ê³¼ (2024-01-19) âœ…

```
=== SPECTER2 Embedding Provider ===
âœ… SpecterEmbeddingProvider imported
âœ… DualEmbeddingProvider imported
âœ… SPECTER2 dimension: 768
âœ… format_paper() works correctly

=== Hierarchical Retriever ===
âœ… HierarchicalRetriever imported
âœ… RetrievalMode: ['child_only', 'parent_expand', 'hybrid']
âœ… suggest_sections_for_query() works

=== Incremental Zotero Sync ===
âœ… sync_folder() method exists
âœ… get_sync_status() method exists
âœ… ëª¨ë“  íŒŒì¼ êµ¬ë¬¸ ê²€ì¦ í†µê³¼
```

**ì‹ ê·œ íŒŒì¼**:
- `backend/llm/specter_embeddings.py` (~280 lines)
- `backend/graph/hierarchical_retriever.py` (~350 lines)

---

## ì˜ì¡´ì„± ì¶”ê°€ (Phase 2+)

```txt
# Phase 2
unstructured>=0.14.0          # ì„¹ì…˜ íƒì§€
unstructured[pdf]             # PDF ì²˜ë¦¬ extras
tiktoken>=0.5.0               # í† í° ì¹´ìš´íŒ…

# Phase 3 (ì„ íƒì )
sentence-transformers>=3.0.0  # SPECTER2
torch>=2.0.0                  # SPECTER2 ì˜ì¡´ì„±
```

---

## Phase 4: Integration (2024-01-19) âœ… ì™„ë£Œ

### 4.1 GraphStore ì²­í¬ ë©”ì„œë“œ âœ…
**íŒŒì¼**: `backend/graph/graph_store.py`

**ì¶”ê°€ëœ ë©”ì„œë“œ**:
- `store_chunks()` - Parent-Child ê´€ê³„ë¡œ ì²­í¬ ì €ì¥
- `create_chunk_embeddings()` - ë°°ì¹˜ ì„ë² ë”© ìƒì„± (SPECTER2 ì˜µì…˜ ì§€ì›)
- `search_chunks()` - ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰ + ì„¹ì…˜ í•„í„°ë§
- `get_chunk_with_context()` - ì²­í¬ + ë¶€ëª¨ ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ
- `get_chunks_by_paper()` - ë…¼ë¬¸ë³„ ì²­í¬ ì¡°íšŒ

### 4.2 Import íŒŒì´í”„ë¼ì¸ í†µí•© âœ…
**ìˆ˜ì • íŒŒì¼**:
- `backend/importers/pdf_importer.py` - SemanticChunker í†µí•©
- `backend/importers/zotero_rdf_importer.py` - SemanticChunker í†µí•©

**ë³€ê²½ ë‚´ìš©**:
- Import ì‹œ ìë™ìœ¼ë¡œ Semantic Chunking ìˆ˜í–‰
- ì²­í¬ ìƒì„± í†µê³„ ë°˜í™˜ (`chunks_created`)
- ì„¹ì…˜ë³„ ì—”í„°í‹° ì¶”ì¶œ (ì˜µì…˜)

### 4.3 Chat/Query í†µí•© âœ…
**ìˆ˜ì • íŒŒì¼**: `backend/agents/query_execution_agent.py`

**ë³€ê²½ ë‚´ìš©**:
- `HierarchicalRetriever` í†µí•©
- `document_search` task type ì¶”ê°€
- `use_chunks`, `section_filter` íŒŒë¼ë¯¸í„° ì§€ì›

### 4.4 Embedding Factory âœ…
**ì‹ ê·œ íŒŒì¼**: `backend/llm/embedding_factory.py`

**ê¸°ëŠ¥**:
- `EmbeddingFactory` - í†µí•© ì„ë² ë”© ì œê³µì íŒ©í† ë¦¬
- `EmbeddingProvider` enum - cohere, specter, dual
- `suggest_provider_for_use_case()` - ì‚¬ìš© ì¼€ì´ìŠ¤ë³„ ì¶”ì²œ

---

## Phase 5: E2E í…ŒìŠ¤íŠ¸ (2024-01-19) âœ… ì™„ë£Œ

### ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ ê²°ê³¼
```
============================================================
ScholaRAG_Graph v0.3.0 - Final Integration Test
============================================================

--- Phase 2: Semantic Chunking ---
âœ… Section Detection
âœ… SemanticChunker.chunk_academic_text()

--- Phase 3: Advanced Features ---
âœ… SPECTER2 EmbeddingProvider class
âœ… HierarchicalRetriever with graph_store param
âœ… Query-to-Section Suggestion

--- Phase 4: Integration ---
âœ… EmbeddingFactory
âœ… GraphStore chunk methods (ëŸ°íƒ€ì„ ì˜ì¡´ì„± í•„ìš”)

============================================================
Tests: 7/7 passed
ğŸ‰ All integration tests passed!
============================================================
```

---

## íŒŒì¼ ë³€ê²½ ë§¤íŠ¸ë¦­ìŠ¤ (ìµœì¢…)

| íŒŒì¼ | Phase | ìƒíƒœ | ë³€ê²½ ë‚´ìš© |
|------|-------|------|----------|
| `importers/zotero_rdf_importer.py` | 1, 4 | âœ… | Tags/notes, SemanticChunker í†µí•© |
| `importers/pdf_importer.py` | 4 | âœ… | SemanticChunker í†µí•© |
| `importers/semantic_chunker.py` | 2 | âœ… | **ì‹ ê·œ** - ì„¹ì…˜ íƒì§€ + ê³„ì¸µì  ì²­í‚¹ |
| `graph/entity_extractor.py` | 1, 2 | âœ… | í™•ì¥ íƒ€ì…, SECTION_PROMPTS |
| `graph/graph_store.py` | 4 | âœ… | ì²­í¬ ì €ì¥/ê²€ìƒ‰ ë©”ì„œë“œ ì¶”ê°€ |
| `graph/hierarchical_retriever.py` | 3 | âœ… | **ì‹ ê·œ** - ê³„ì¸µì  ê²€ìƒ‰ |
| `llm/specter_embeddings.py` | 3 | âœ… | **ì‹ ê·œ** - SPECTER2 provider |
| `llm/embedding_factory.py` | 4 | âœ… | **ì‹ ê·œ** - ì„ë² ë”© íŒ©í† ë¦¬ |
| `agents/query_execution_agent.py` | 4 | âœ… | HierarchicalRetriever í†µí•© |
| `database/migrations/011_*.sql` | 2 | âœ… | **ì‹ ê·œ** - semantic_chunks ìŠ¤í‚¤ë§ˆ |

---

## ì˜ˆìƒ ì¼ì •

| Phase | ê¸°ê°„ | ìƒíƒœ |
|-------|------|------|
| Phase 1 | 1-2ì¼ | âœ… ì™„ë£Œ |
| Phase 2 | 3-5ì¼ | âœ… ì™„ë£Œ |
| Phase 3 | 5-7ì¼ | âœ… ì™„ë£Œ |
| Phase 4 | 1-2ì¼ | âœ… ì™„ë£Œ |
| Phase 5 | 1ì¼ | âœ… ì™„ë£Œ |
| **ì´ê³„** | **~2-3ì£¼** | ğŸ‰ **v0.3.0 ë¦´ë¦¬ìŠ¤ ì¤€ë¹„ ì™„ë£Œ** |
