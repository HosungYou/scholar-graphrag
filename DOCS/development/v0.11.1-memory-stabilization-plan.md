# v0.11.1 Memory Stabilization Plan

**Date**: 2026-02-06  
**Scope**: Render web service `scholarag-graph-docker` memory limit exceed 대응

## 1. Symptom

- 프로젝트 페이지 재진입 시 백엔드 메모리 한도 초과가 간헐적으로 발생
- PostgreSQL 로그에는 연결/인증/해제 반복이 보이나, 인증 실패 패턴은 확인되지 않음

## 2. Current Hypothesis

1. 프로젝트 진입 시 동시 호출되는 고비용 API 조합으로 순간 메모리 피크 발생
2. 갭 분석 auto-refresh가 재진입 때 반복 트리거되어 비용이 누적
3. 캐시가 bounded 되지 않으면 장시간 실행 시 메모리 누적 가능

## 3. Priority Plan

### P0 (Applied in v0.11.1)

1. Visualization response shaping
- `max_edges` 상한 추가로 대형 edge payload 제한

2. Centrality cache bounding
- centrality cache를 LRU 20개로 제한

3. Reopen guard for gap auto-refresh
- project별 auto-refresh 1회 제한

### P1 (Needs deployment + runtime verification)

1. Render 메모리 시계열 확인
- 배포 후 24시간 기준 peak RSS/재시작 횟수/503 추적

2. 재진입 시나리오 검증
- 동일 프로젝트 10회 재진입에서 메모리 추이 확인

3. 장애 기준선 설정
- alert 임계치와 대응 runbook(재시도/패널 축소/수동 refresh) 확정

### P2 (Next optimization wave)

1. Graph metrics endpoint TTL cache
- `/metrics`, `/diversity`, `/centrality` 결과를 project 단위 단기 캐시

2. Heavy analysis async job 전환
- 동기 refresh를 백그라운드 job으로 전환하고 polling으로 상태 조회

3. Runtime memory observability endpoint
- `/api/system/metrics/runtime` 형태로 RSS, cache size, queue depth 노출

## 4. Acceptance Criteria

1. Render 메모리 limit exceed 이벤트 0건 (24시간)
2. 프로젝트 재진입 반복 시 응답 지연/503 증가 없음
3. 수동 gap refresh 호출 빈도와 평균 처리 시간 감소

